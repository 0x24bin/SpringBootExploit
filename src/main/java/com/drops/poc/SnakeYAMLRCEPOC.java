package com.drops.poc;

import com.drops.utils.HTTPUtils;
import com.drops.utils.ReUtil;

/**
 * @ClassName: SnakeYAMLRCE
 * @Description: TODO
 * @Author: Summer
 * @Date: 2021/7/28 16:05
 * @Version: v1.0.0
 * @Description:
 **/
public class SnakeYAMLRCEPOC  {


    /**
     * @Description: 判断是否存在依赖spring-boot-starter-actuator
     * spring-cloud-starter 版本 < 1.3.0.RELEASE
     * @param target
     *
     * @return:
     */
    public static boolean hasSnakeYAMLRCE(String target){
        String regex = "spring-cloud-starter-([A-Za-z0-9.-]+).jar";
        String context = HTTPUtils.getRequest(target).body();
        String version = "spring-cloud-starter-1.3.0";
        System.out.println("正在验证是否存在依赖spring-boot-starter-actuator以及 spring-cloud-starter 版本 < 1.3.0！");
        if (context.contains("spring-boot-starter-actuator")){
            System.out.println("存在依赖：spring-boot-starter-actuator");
            String result = ReUtil.hasVersion(context,regex);
            if (result != null){
                if (result.compareToIgnoreCase(version) >= 0){
                    System.out.println("依赖版本不符合，版本为：" +  result);
                }else {
                    System.out.println("依赖版本：" + result);
                    return true;
                }
            }else {
                System.out.println("spring-cloud-starte 依赖不存在！");
            }

        }else{
            System.out.println("spring-boot-starter-actuator  依赖不存在！");
            return false;
        }
        return false;
    }



}
