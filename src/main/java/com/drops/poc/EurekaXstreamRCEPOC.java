package com.drops.poc;

import com.drops.utils.HTTPUtils;
import com.drops.utils.ReUtil;

/**
 * @ClassName: EurekaXstream
 * @Description: TODO
 * @Author: Summer
 * @Date: 2021/7/29 10:12
 * @Version: v1.0.0
 * @Description:
 **/
public class EurekaXstreamRCEPOC {

    /**
     * @param target
     * @Description: 判断是否存在spring-boot-starter-actuator
     * eureka-client < 1.8.7（通常包含在 spring-cloud-starter-netflix-eureka-client 依赖中）
     * @return:
     */
    public static boolean hasEurekaXstreamRCE(String target) {
        String regex = "eureka-client([A-Za-z0-9.-]+).jar";
        String context = HTTPUtils.getRequest(target).body();
        String version = "eureka-client-1.8.7";
        System.out.println("正在验证是否存在依赖spring-boot-starter-actuator以及 eureka-client 版本 < 1.8.7！");
        if (context.contains("spring-boot-starter-actuator")){
            System.out.println("存在依赖：spring-boot-starter-actuator");
            String result = ReUtil.hasVersion(context,regex);
            if (result != null){
                if (result.compareToIgnoreCase(version) >= 0){
                    System.out.println("依赖版本不符合，版本为：" +  result);
                }else {
                    System.out.println("依赖版本：" + result);
                    return true;
                }
            }else {
                System.out.println("eureka-client  依赖不存在！");
            }

        }else{
            System.out.println("spring-boot-starter-actuator  依赖不存在！");
            return false;
        }
        return false;
    }


}